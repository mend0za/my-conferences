h1. XMPP/Jabber глазами мантейнера сервера jabber.org.by

Сервер "jabber.org.by (он же jabber.linux.by)":http://jabber.org.by - первый и в настоящее время единственный в Беларуси публичный XMPP/Jabber сервер.

Отличительные особенности:
# community-driven
# широкий набор транспортов
# физически расположен в Беларуси (провайдер BASNET). 

Опыт поддержки и эксплуатации указанного сервера в течении 9 лет положен в основу  настоящей статьи.

h2. Технология XMPP/Jabber

Протокол *XMPP* (*Extensible Messaging and Presence Protocol* - _расширяемый протокол обмена сообщениями и информацией о присутствии_). Основан на формате XML и изначально спроектирован расширяемым. Стандартизирован в настоящее время в RFC 6120, RFC 6121, и RFC 6122. Плюс расширения (XEP) от "XMPP Standarts Foundation":http://xmpp.org .

Существует огромное множество реализаций XMPP, клиентских и серверных, как общего назначения, так и специализированных. 

Поддерживаются очевидные для Instant Messenging возможности передачи текстовых сообщений, групповых чатов, серверной истории, передачи голоса и видео, а также файлов.

Существенным отличием от многих других IM является децентрализованность. В XMPP адрес пользователя состоит из двух частей: login@server. Каждый сервер является независимой сущностью, которая договаривается о доставке сообщений с другими серверами посредством протокола XMPP. Этот процесс называется XMPP Federation или XMPP s2s. 

Наиболее интересные возможности и способы применения
* серверные шлюзы ("транспорты") в сети на других технологиях (ICQ, Skype, MSN, SIP, IRC, Email). Включая другие сервера на XMPP. Включая подписку на транспорты других серверов.
* Шифрование: канал клиент-сервер и сервер-сервер. Также можно шифровать отдельные сообщения открытым ключом.
* Удалённая передача команд и мониторинг состояния, в том числе управление клиентами и серверами XMPP.
* Инструменты совместной работы (Abiword, Inkscape, LibreOffice, Coccinella, всевозможные whiteboard)
* Микроблоггинг
* Различные сетевые распределённые настольные игры
* Geolocation
* Сервисы идентификации : OpenID, OAuth
* Облачные вычисления

h3. Подъём и, одновременно, падение XMPP.

На настоящий момент технология  XMPP очевидно устоялась и заняла своё. Многие популярные интернет сервисы имеют XMPP на борту, в частности Facebook, GTalk, Vkontakte, WhatApp. Большинство бизнес-ориентированных решений или имеют транспорты для подключения к XMPP Federation (Microsft Lync, Cisco Unified Presence), или прямо основаны на XMPP.

С другой стороны, большинство разработчиков корпоративных и открытых решений делает продукты под себя.  Выбрасывая или обрезая штатный функционал протокола и широко распространённые расширения.

С серверной стороны - зачастую мы можем видеть отключение s2s (Facebook), невозможность поменять личные данные через VCard (почти все), странное нестандартное поведение аккаунтов и серверов (Google Talk), отключенной server-side history, нет поддержки групп  и т.д. 

С клиентской - нет поддержки Service Discovery (imo, im+, xabber), и связанной с ней регистрации на транспортах и выполнения команд, нет поддержки конференций, а иногда даже групп пользователей в ростере (imo). Особенно этим грешат многопротокольные клиенты, где XMPP лишь одна из опций.

Суммируем - теоретическое богатство возможностей XMPP, описанных в предыдущем пункте, недоступно в коробочном, простом для использования, продукте. Требует дополнительных ощутимых усилий со стороны оператора сервера и конечного пользователя по настройке окружения.

Таким образом, мы можем смело говорить об протоколах, расширениях  и програмном обеспечении XMPP как о наборе заготовок "сделай сам".

h3. Заметки к Второй Мировой Войне среди IM's. 

Первая Мировая Война IM началась после взлёта ICQ в конце 90х. Ключевым функционалом того времени являлась передача текста и групповые чаты.  В короткое время были созданы конкурирующие продукты: AIM, Yahoo Messenger, MSN и другие, мало отличающиеся функционалом, но абсолютно несовместимые друг с другом и обладающие закрытыми двоичными протоколами. 

Со стороны пользователей практически сразу возник спрос на интеграцию множества аккаунтов в одну точку входа.

К середине 2000х все  протоколы IM подверглись реверс-инженерингу, и к ним были написаны реализации XMPP-транспортов, что позволило использовать Jabber-аккаунт как единую точку входа во все сети, а особенности реализации маскировались 

 

В настоящее время снова остро встала проблема по несовместимости протоколов между собой.  Коммерческие вендоры, стремясь наглухо привязать пользователей исключительно к своим сервисам, снова активно выбрасывают и проталкивают на рынок полностью закрытые решения, зачастую не имеющие даже внешнего API. В частности отдельным недобрым словом можно отметить Skype, Viber, WhatsApp. 

# ад несовместимых протоколов - Skype, Viber, WhatsApp and so on. 
# анальное огораживание вендоров - Facebook и остальные. О важности XMPP Federation.
# Былинный отказ Google Talk. Что же произошло на самом деле, на материалах http://m.habrahabr.ru/post/180159/.

h2. Сервер jabber.org.by

Сервер "jabber.org.by (он же jabber.linux.by)":http://jabber.org.by является публичным, общедоступным сервером,  с открытой регистрацией. Содержит большой выбор общедоступных транспортов: ICQ, MSN, AIM, Yahoo, Twitter, MRIM и несколько транспортов в XMPP под разными именами.

Внутренняя политика: оператор вмешивается в происходящее только тогда, когда деятельность пользователей мешает работать серверу и ставит под угрозу его работоспособность. Всё остальное - на полное усмотрение участников.

Физически со времени старта сервиса располагается по адресу г. Минск, ул. Академическая 25, 5й этаж, в сети Национальной академии наук Беларуси "BASNET":http://basnet.by. Время от времени перемещается внутри этого здания с сервера на сервер.

Hardware: 
* Контейнер в OpenVZ
* RAM 2GB гарантировно /  до 4GB если другие контейнеры не требуют.  
* 40 GB HDD
* Intel(R) Xeon(R) CPU E5506  @ 2.13GHz . 
Software: 
* Debian GNU/Linux 6.x (oldstable)
* "Ejabberd 2.1.12":http://www.process-one.net/en/ejabberd
* транспорты на основе сервисов "Spectrum2":http://spectrum.im


h3. История jabber.org.by

* 14 декабря 2004 года. Запуск. Александр Бутенко aka Mr_Death разместил "анонс в рассылке Minsk Linux Users Group":http://article.gmane.org/gmane.user-groups.linux.minsk.general/173 .

* Октябрь-декабрь 2005. Пользователи во главе с cymrak, booxter и trenka по своей инициативе собирают деньги и апгрейдят сервер. "Подробности":https://forum.linux.by/viewtopic.php?f=2&t=8455

* 2006. эмиграция Mr_Death в Доминиканскую Республику и постепенный отход от дел.

* март 2008. Остановка сервиса и далее переезд на FreeBSD 6.2/jailю "Подробнее":https://forum.linux.by/viewtopic.php?t=9555

* август 2009. Участие в исправлении утечки памяти в PyICQt

* февраль 2011. Переезд на Debian 6.x/OpenVZ. Переход на сервисы Spectrum.

* сентябрь 2012-май 2013. Эпическая Борьба с сирийскими ботами.

* июнь 2013. Потеря пользовательских паролей (неудачный апдейт)

h3. Текущее состояние сервера.

50-70 активных пользователей онлайн единовременно (цифра снизилась в 2 раза за 3 года).

Транспорты: ICQ - до 150 пользователей онлайн, MSN - до 140 пользоватей, различные варианты J2J - до 100 пользователей. 

Среди пользователей транспортов наибольшее количество пришельцев (по убывающей) c GTalk/gmail.com, jabber.ru и jabber.org, не имеющих собственных транспортов.

S2S (соединения с другими серверами) - 130-150 единовременно.


h2. Эволюция из пользователя в мантейнера сервера

В момент старта я был обычным пользователем. В приблизительно 2005-2006 - стал постепенно резервным администратором, а к 2008 - единственным. 

В полном соответствии с классическим эссе Эрика Реймонда "The Cathedral and the Bazaar":
# пользуюсь сам большей частью функционала
# слушаю что просят пользователи
# развитие проекта определяется его пользователями
# стараюсь по мере сил взаимодействовать с upstream 


h2. Литература и ссылки
# Сервер "jabber.org.by":http://jabber.org.by
# "Eric S. Raymond. The Cathedral and the Bazaar":http://www.catb.org/esr/writings/homesteading/


